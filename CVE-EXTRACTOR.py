import os
import pdfplumber
import re

def estrai_cve_da_pdf(pdf_path):
    cve_pattern = r'CVE-\d{4}-\d{4,7}'
    cve_set = set()

    with pdfplumber.open(pdf_path) as pdf:
        for page in pdf.pages:
            text = page.extract_text()
            cve_list = re.findall(cve_pattern, text)
            cve_set.update(cve_list)

    return cve_set

def salva_cve_su_file(cve_set, output_file):
    with open(output_file, 'w') as f:
        for cve in cve_set:
            f.write(f"{cve}\n")

def main():
    # Trova il primo file PDF nella directory corrente
    pdf_files = [file for file in os.listdir() if file.endswith('.pdf')]
    if pdf_files:
        pdf_path = pdf_files[0]
        print(f"Trovato il file PDF: {pdf_path}")

        # Estrai le CVE dal PDF
        cve_set = estrai_cve_da_pdf(pdf_path)

        if cve_set:
            output_file = 'cve_list.txt'
            salva_cve_su_file(cve_set, output_file)
            num_cve = len(cve_set)
            print(f"Le CVE sono state estratte con successo e salvate in {output_file}.")
            print(f"Numero totale di CVE uniche estratte: {num_cve}")
        else:
            print("Nessuna CVE trovata nel file PDF.")
    else:
        print("Nessun file PDF trovato nella directory corrente.")

if __name__ == "__main__":
    main()